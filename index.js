const express = require("express");
const noblox = require("noblox.js");

const app = express();
app.use(express.json());

const ROBLOSECURITY = process.env._|WARNING:-DO-NOT-SHARE-THIS.--Sharing-this-will-allow-someone-to-log-in-as-you-and-to-steal-your-ROBUX-and-items.|_CAEaAhAB.208B93C612BF66E18474F721051B4B91190458973209C148A8A2DC749D61D99C5DB9AE1430BFDA23521E5F3FD121E825B6DC5294BFC9779CC9760383F675BAA4A371A559B55239AF915736DD89BBA6D631CD0A84E7CCE16AFE041653C146A6EB79351621DA0B2BFA69C80BA37D943081D894C4B7D57F83CD02FCDD4038BBFF52AFF29F523BFCB094D35D279D9CAF1C630EEEDBF11048A4DCB3B999E625228244352B44AC7AA8CBE9622A4CB889D6B33048F2734B44A7168DEAE2633C573C26A73B9DFAED2C8E62B8CA4BB1A5AEF7F218ADF432F08A63B7177D068DB10C359EB0AAC64B00D32E015002636D899CCA71D67F5CA26F364F306C2A65AAB40EB201CD7C49B79F068CE89C11A14654124F7BE0F557C82D22ABD36071A5ABD535BD09B55A15E33A74C469874A837EF1EDAF3C140660860AC6C735A63A02196E18F4F3A8F0B6598228FDC38211A3421D8B5F9AC912704A80418769B1CF13DC0F9FB909CABF87E18E0F45F2447BE95BA056EB9B69A3ED5041872E5593F021230DA1304F29AAE0351CC5A54C64661AC25FA7395BCEB28DA533C7311C6388886FE7982A725A85D07054B2DD727FE9B814E0779E65272E03017E1623674D8F1DF5F3F196FEA75D218760EC8399B9FADAABB3FC855C0B29D6BC6BEAFC6012210AC882C5DA9E8DACA05A89E02FDF22E6B03C93FC1238467474BA8FA7F31795B8B5F247E95CB253C5AE38CA0494373886C45E66BEB19EB46CE889FFE3A3AAC50B53B9B58A56863B022336744294938D5CD98095A43AE7EDCBD4EFF1C3546CB9BD2CBBEE122D42BFA27E54046A570EE6CD17595B03C868943896C28F9A9D4AC8CD8E653D5BEF4745D688E05512C28439292F76914CFED54298A7669B9E5E680272550C5550AE022005BF0BC7039D016474BDF73C76438BE3AE1C4C75C9D0B698B2CB847ABD5DFE9B9E864407853FA2236D1366E54D42A345CD8DFB5E61B46B89E258A46566D91CBFFB874D08F8562C5FAA00947FBD03549F8204ED6D9AE4ABB836EDDC243A2B5D1A36D648A6DFFAF453105F25EE9A3211CCA4B8436B45D473006A5B46137A5B3E3759E763C529A262912D74943CEB9E707CD2189E1ABD36082609FC12851482A3FC9D8A758A172948107F6BAA5317246A38A8B8E24308E388C0CCCBEB041EA968A36614EE4AE4D859BE2389AB2809919154F2269801360DF71AC9A5AC86DA0E361E1B25B1FA; // Renderã®ç’°å¢ƒå¤‰æ•°ã«ã‚»ãƒƒãƒˆæ¸ˆã¿
const GROUP_ID = 35148239; // ã‚ãªãŸã®ã‚°ãƒ«ãƒ¼ãƒ—IDã«å¤‰æ›´ã—ã¦ãã ã•ã„
const TARGET_RANK = 5;     // æ˜‡æ ¼ã•ã›ãŸã„ãƒ©ãƒ³ã‚¯ç•ªå·

async function startBot() {
  try {
    await noblox.setCookie(ROBLOSECURITY);
    console.log("âœ… Robloxã«ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ");
  } catch (err) {
    console.error("âŒ Robloxãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:", err);
  }
}

startBot();

app.post("/promote", async (req, res) => {
  try {
    const { username } = req.body;
    if (!username) {
      return res.status(400).send("username is required");
    }

    // usernameã‹ã‚‰userIdã‚’å–å¾—
    const userId = await noblox.getIdFromUsername(username);
    // æŒ‡å®šã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ©ãƒ³ã‚¯ã‚’å¤‰æ›´
    await noblox.setRank(GROUP_ID, userId, TARGET_RANK);

    console.log(`âœ… ${username} ã‚’ãƒ©ãƒ³ã‚¯${TARGET_RANK}ã«æ˜‡æ ¼ã—ã¾ã—ãŸ`);
    res.status(200).send(`Promoted ${username} to rank ${TARGET_RANK}`);
  } catch (error) {
    console.error("âŒ ã‚¨ãƒ©ãƒ¼:", error);
    res.status(500).send("Failed to promote user");
  }
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`ğŸŒ Server running on port ${PORT}`);
});
